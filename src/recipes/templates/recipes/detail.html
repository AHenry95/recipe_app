{% extends 'recipes/base.html' %}
{% load static %}

{% block title %}{{recipe.name}}{% endblock %}

{% block content %}
<main>
    <a href="{% url 'recipes:list' %}" class="back-link">Back to Recipe List</a>

    <div class="recipe-detail">
        <div class="recipe-hero">
            <img src="{{recipe.pic.url}}" alt="{{recipe.name}}">
        </div>

        <div class="recipe-content">

            <div class="recipe-header">
                <h1 class="recipe-title">{{recipe.name}}</h1>
                <div class="recipe-header-row">
                    <div class="recipe-badges">
                        <span class="badge">‚è± {{recipe.cooking_time}} minutes</span>
                        <span class="difficulty-badge difficulty-{{recipe.difficulty|lower}}">
                            {{recipe.difficulty}}
                        </span>
                    </div>

                    {% if user.is_authenticated %}
                    <form method="POST" action="{% url 'recipes:favorite' pk=recipe.pk %}" class="favorite-form">
                        {% csrf_token %}
                        <button type="submit" class="favorite-btn {% if user in recipe.favorited_by.all %}favorited{% endif %}">
                            {% if user in recipe.favorited_by.all %}Favorited{% else %}Add Favorite{% endif %}
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>
            
            <section class="recipe-section">
                <h2 class="section-title">Ingredients</h2>
                <ul class="ingredients-list">
                    {% for ingredient in recipe.get_ingredients_list %}
                    <li>{{ingredient}}</li>
                    {% endfor %}
                </ul>
            </section>

            <section class="recipe-section">
                <h2 class="section-title">Instructions</h2>
                <p class="instructions-text">{{recipe.instructions}}</p>
            </section>

            {% if user == recipe.author %}
            <div class="author-actions">
                <a href="{% url 'recipes:edit' pk=recipe.pk %}" class="btn btn-secondary">Edit Recipe</a>
                <button type="button" class="btn btn-danger" onclick="openDeleteModal()">Delete Recipe</button>
            </div>
            {% endif %}
        </div>
    </div>
</main>

{% if user.is_authenticated %}
<script src="{% static 'recipes/js/favorite_handler.js' %}"></script>
{% endif %}

{% if user == recipe.author %}
<div id="deleteModal" class="modal-overlay">
<div class="modal-content">
    <h2>Delete Recipe</h2>
    <p>Are you sure you want to delete <strong>{{recipe.name}}</strong></p>
    <p class="delete-warning">This action cannot be undone</p>

    <form method="POST" action="{% url 'recipes:delete' pk=recipe.pk %}">
        {% csrf_token %}
        <div class="modal-buttons">
            <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
            <button type="submit" class="btn btn-danger">Yes, Delete</button>
        </div>
    </form>
</div>
</div>

<script src="{% static 'recipes/js/modal.js' %}"></script>
{% endif %}
{% endblock %}